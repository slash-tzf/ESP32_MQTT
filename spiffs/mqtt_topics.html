<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
  <title>ESP-MQTT主题</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="./img/favicon.ico">
  <style>
    /* MQTT主题页面额外样式 */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-item {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    
    .form-item label {
      width: 80px;
      text-align: right;
      margin-right: 20px;
      color: black;
    }
    
    /* 修改输入框样式，使其在大屏幕上自适应宽度 */
    .form-item input, .form-item textarea {
      width: 100%;
      max-width: 600px;
      border: 1px solid #CCCCCC;
      border-radius: 5px;
      padding: 5px 10px;
      box-sizing: border-box;
    }
    
    /* 订阅主题输入框样式 */
    .form-item.add-topic-item {
      display: flex;
      flex-wrap: wrap;
    }
    
    .form-item.add-topic-item input {
      flex: 1;
      min-width: 200px;
      max-width: 600px;
    }
    
    .form-item textarea {
      height: 80px;
      resize: vertical;
    }
    
    .btn-primary {
      background-color: #1890FF;
      color: white;
      width: 70px;
      height: 35px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      transition: background-color .2s;
      margin-left: 10px;
    }
    
    .btn-primary:hover {
      background-color: #40a9ff;
    }
    
    .btn-danger {
      background-color: #ef2626;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    
    .error-message {
      margin-top: 5px;
      font-size: 14px;
      min-height: 20px;
    }
    
    /* 表格响应式样式 */
    .responsive-table {
      width: 100%;
      max-width: 100%;
      overflow-x: auto;
    }
    
    /* 确保表格在小屏幕上能够完整显示 */
    .page-detail {
      overflow-x: auto;
      padding: 10px 0;
    }
    
    /* 改进页面切换选项卡样式 */
    .page-header {
      display: flex;
      margin-bottom: 20px;
      border-bottom: none;
      background-color: #f5f5f5;
      border-radius: 5px;
      overflow: hidden;
      height: 45px;
      padding-left: 0px;
    }
    
    .page-tab {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s ease;
      color: #666;
      border-bottom: 3px solid transparent;
      text-align: center;
    }
    
    .page-tab.active {
      background-color: #fff;
      color: #1890FF;
      font-weight: bold;
      border-bottom: 3px solid #1890FF;
    }
    
    .page-tab:hover:not(.active) {
      background-color: #e8e8e8;
    }
    
    .page-tab:before {
      content: "";
      font-family: sans-serif;
      margin-right: 6px;
      font-size: 18px;
    }
    
    .page-tab-subscribe:before {
      content: "📥";
    }
    
    .page-tab-publish:before {
      content: "📤";
    }
    
    .page-tab-settings:before {
      content: "⚙️";
    }
    
    /* 密码输入框样式 */
    .password-container {
      position: relative;
      display: flex;
      flex: 1;
    }
    
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #999;
    }
    
    /* 修改表格在移动设备上的显示 */
    @media (max-width: 768px) {
      .form-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .form-item label {
        margin-bottom: 5px;
        width: 100%;
        text-align: left;
      }
      
      .form-item input, .form-item textarea {
        width: 100%;
      }
      
      .btn-primary {
        margin-top: 10px;
        margin-left: 0;
      }
      
      /* 针对移动设备优化表格 */
      .tableStyle {
        width: 100%;
        min-width: auto;
      }
      
      .tableStyle th:first-child {
        width: 70%;
      }
      
      .tableStyle th:last-child {
        width: 30%;
      }
      
      .tableStyle td, .tableStyle th {
        padding: 8px 5px;
      }
      
      /* 确保按钮在移动设备上显示正常 */
      .btn-danger {
        white-space: nowrap;
        padding: 5px 8px;
      }
      
      /* 调整右侧内容区域的边距 */
      .right-base {
        padding: 10px 5px;
      }
      
      /* 页面内容区域宽度调整 */
      .page-content {
        padding: 10px 5px;
      }
    }
  </style>
</head>

<body>
  <div class="home-base">
    <div class="header-base flex flex-jcb">
      <img class="header-logo" src="./img/logoBlack.png">
      <div class="header-menu" onclick="menuClick(this)">
      </div>
    </div>
    <div class="content-base flex">
      <div class="left-base" id="leftMenu">
        <ul>
          <li>
            <a href="index.html">系统状态</a>
          </li>
          <li>
            <a href="wlan.html">WLAN设置</a>
          </li>
          <li>
            <a href="wifi_sta.html">WiFi STA设置</a>
          </li>
          <li>
            <a href="sensors.html">传感器数据</a>
          </li>
          <li>
            <a href="mqtt_topics.html" class="content">MQTT主题管理</a>
          </li>
        </ul>
      </div>
      <div class="right-base">
        <div class="page-header">
          <div id="tabSubscribe" class="page-tab page-tab-subscribe active" onclick="showSubscribeTopics()">订阅主题</div>
          <div id="tabPublish" class="page-tab page-tab-publish" onclick="showPublishPanel()">发布消息</div>
          <div id="tabSettings" class="page-tab page-tab-settings" onclick="showSettingsPanel()">MQTT设置</div>
        </div>

        <!-- 订阅主题面板 -->
        <div class="page-content" id="subscribeTopicsPanel">
          <div class="page-title">已订阅主题</div>
          <div class="page-detail">
            <table class="tableStyle tCenter">
              <thead>
                <tr>
                  <th>主题</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="topicsList"></tbody>
            </table>
          </div>
          
          <div class="page-title">添加订阅主题</div>
          <div class="form-group">
            <div class="form-item add-topic-item">
              <input type="text" id="newTopic" placeholder="输入主题名称">
              <button class="btn-primary" onclick="addTopic()">添加</button>
            </div>
            <div class="error-message" id="topicError"></div>
          </div>
        </div>

        <!-- 发布消息面板 -->
        <div class="page-content" id="publishPanel" style="display: none;">
          <div class="page-title">发布消息</div>
          <div class="form-group">
            <div class="form-item">
              <label>目标主题:</label>
              <input type="text" id="publishTopic" placeholder="输入发布的主题名称">
            </div>
            <div class="form-item">
              <label>消息内容:</label>
              <textarea id="publishMessage" placeholder="输入要发布的消息内容" rows="5"></textarea>
            </div>
            <div class="form-item">
              <button class="btn-primary" onclick="publishMessage()">发布</button>
            </div>
            <div class="error-message" id="publishError"></div>
          </div>
        </div>
        
        <!-- MQTT设置面板 -->
        <div class="page-content" id="settingsPanel" style="display: none;">
          <div class="page-title">MQTT服务器配置</div>
          <div class="form-group">
            <div class="form-item">
              <label>状态:</label>
              <div id="mqttStatusDisplay">
                <span style="color: #999999;">⚪ 未连接</span>
              </div>
            </div>
            <div class="form-item">
              <label>Broker:</label>
              <input type="text" id="mqttBroker" placeholder="例如: mqtt://mqtt.example.com:1883">
            </div>
            <div class="form-item">
              <label>用户名:</label>
              <input type="text" id="mqttUsername" placeholder="MQTT用户名(可选)">
            </div>
            <div class="form-item">
              <label>密码:</label>
              <div class="password-container">
                <input type="password" id="mqttPassword" placeholder="MQTT密码(可选)">
                <span class="toggle-password" onclick="togglePasswordVisibility()">👁️</span>
              </div>
            </div>
            <div class="form-item">
              <button class="btn-primary" style="width: 120px;" onclick="saveMqttSettings()">保存设置</button>
            </div>
            <div class="error-message" id="settingsError"></div>
            <div id="settingsSuccess" style="color: green; margin-top: 10px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="js/mqtt_topics.js"></script>
</body>

</html> 